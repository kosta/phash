<!DOCTYPE html>
<!-- 
  Licensed under terms of the WTF?! License
  Programs licensed under the WTF?! License are so fscking simple
  that they don't even count as a "demo" or "example" program, but
  instead could be written by your grandma or a five-year old, respectively.
  Do whatever dirty deeds you want with programs licensed under the WTF?!
  license. Even something evil. I mean: WTF?!
-->
<html manifest="phash.manifest">
  <head>
    <link rel="apple-touch-icon" href="phash.png" />
    <meta name="viewport" content="user-scalable=no, width=device-width" />
    <title>phash</title>
    <style type="text/css">
      .phash { font-size: xx-large; font-weight: bold; font-size: x-large }
      a { text-decoration: none; }
      .header { color: #555; margin: 0; padding: 0; font-size: x-large }
      .result { font-weight: bold; border: 0px; font-family: monospace; text-color: blue; 
        text-align: center; width: 95%; max-width: 310px; background-color: #ddd; }
      .red { color: red; font-weight: bold; }
      body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; overflow: hidden }
      .info { font-size: small; }        
    </style>
  </head>
  <body>
      <div class=header>
        one password<br>
        to hash them all
      </div>
      <form onSumbit="javascript:(function(){return false;})()">
        <div class=f>
          <p>
            master password:<br>
            <input type="password" size="16">
            <span id="pex" class="red"></span><br>
          </p>
          <p>
            website (or whatever):<br>
            <input type="text" size="16">
            <span id="tex" class="red"></span>
          </p>
        <a class="phash" href="#">phash...</a>
      </form>
      <p>
        <div>
          Your new password:<br>
          <input class="result" type="text" id="result"></input><br>
          <input type="range" min="10" max="40" value="40" id="range" disabled/>
          <span id="rangec"></span>
        </div>
      </p>      
      <div class="info">
        <a href="http://github.com/kosta/phash">more info</a><br>
        Got Feedback? Tell <a href="http://twitter.com/alicelikesbob">@alicelikesbob</a> on twitter
      </div>
  </body>
  <script src="sha1.js"></script>
  <script src="jquery-1.4.2.min.js"></script>
  <script>
    function check1() {
      var ret = $("form input:password")[0].value;
      //require at least some input
      $("#pex").text(("" === ret) ? "!" : "");
      return ret;
    } //check1
    function check2() {
      var ret = $("form input:text")[0].value;
      $("#tex").text(("" === ret) ? "!" : "");
      return ret;
    }
    var phash = (function() {
      var value = '';
      return { 
        set: function() {
          var a1 = check1();
          var a2 = check2();
          if (a1 !== '' && a2 !== '') {
            //output hash
            value = hex_sha1(a1+a2);
            $("#result").val(value).focus().select();
            $("#range").attr("disabled", false);
          } //both have values
          return false;
        }, //set()
        get: function(i) {
          i = i || value.length;
          return value.substr(0, i);
        } //get
      }
    })(); //phash
    $(function() { 
      $(".phash").attr("href", "javascript:(function(){phash.set();return false;})()");
      $(".phash").text("phash!");
      $("form input:password").change(check1);
      $("form input:input").change(check2);
      $("#range").change(function() {
        $("#rangec").text(this.value);
        $("#result").val(phash.get(this.value)).focus().select();
      });
    }); //$(function)
  </script>
</html>